{"ast":null,"code":"import { Role } from './';\nexport function configureFakeBackend() {\n  let users = [{\n    id: 1,\n    username: 'admin',\n    password: 'admin',\n    firstName: 'Admin',\n    lastName: 'Admin',\n    role: Role.Admin,\n    name: \"Admin\",\n    second_name: null,\n    email: null,\n    phone: \"380953444348\"\n  }, {\n    id: 2,\n    username: 'user',\n    password: 'user',\n    firstName: 'Ivan',\n    lastName: 'User',\n    role: Role.Admin,\n    name: \"User\",\n    second_name: null,\n    email: null,\n    phone: \"380953444348\"\n  },, {\n    id: 3,\n    username: 'pro',\n    password: 'pro',\n    firstName: 'Model',\n    lastName: 'Provider',\n    role: Role.Provider,\n    name: \"Model\",\n    second_name: null,\n    email: null,\n    phone: \"380953444348\"\n  }];\n  let realFetch = window.fetch;\n\n  window.fetch = function (url, opts) {\n    const authHeader = opts.headers['Authorization'];\n    const isLoggedIn = authHeader && authHeader.startsWith('Bearer fake-jwt-token');\n    const roleString = isLoggedIn && authHeader.split('.')[1];\n    const role = roleString ? Role[roleString] : null;\n    return new Promise((resolve, reject) => {\n      // wrap in timeout to simulate server api call\n      setTimeout(() => {\n        // authenticate - public\n        if (url.endsWith('/api/auth/login') && opts.method === 'POST') {\n          const params = JSON.parse(opts.body);\n          const user = users.find(x => x.username === params.username && x.password === params.password);\n          if (!user) return error('Username or password is incorrect');\n          return ok({\n            id: user.id,\n            username: user.username,\n            firstName: user.firstName,\n            lastName: user.lastName,\n            role: user.role,\n            token: `fake-jwt-token.${user.role}`,\n            name: user.name,\n            second_name: user.second_name,\n            email: user.email,\n            phone: user.phone,\n            rating: user.rating,\n            position: user.position,\n            telegram: user.telegram,\n            viber: user.viber,\n            whatsapp: user.whatsapp,\n            site: user.site,\n            avatar: user.avatar,\n            email_verified_at: user.email_verified_at,\n            activate: user.activate,\n            bx_id: user.bx_id,\n            created_at: user.created_at,\n            updated_at: user.updated_at,\n            deleted_at: user.deleted_at,\n            chats: user.chats\n          });\n        }\n\n        if (url.endsWith('/api/auth/register') && opts.method === 'POST') {\n          const params = JSON.parse(opts.body);\n          const user = {\n            id: users.length + 1,\n            username: params.username,\n            password: params.password,\n            firstName: 'Normal',\n            lastName: Role.User,\n            name: null,\n            second_name: null,\n            email: null,\n            phone: null,\n            rating: null,\n            position: null,\n            telegram: null,\n            viber: null,\n            whatsapp: null,\n            site: null,\n            avatar: null,\n            email_verified_at: null,\n            activate: null,\n            bx_id: null,\n            created_at: null,\n            updated_at: null,\n            deleted_at: null,\n            chats: null\n          };\n          users.push(user);\n          return ok({\n            id: user.id,\n            username: user.username,\n            firstName: user.firstName,\n            lastName: user.lastName,\n            role: user.role,\n            token: `fake-jwt-token.${user.role}`,\n            name: user.name,\n            second_name: user.second_name,\n            email: user.email,\n            phone: user.phone,\n            rating: user.rating,\n            position: user.position,\n            telegram: user.telegram,\n            viber: user.viber,\n            whatsapp: user.whatsapp,\n            site: user.site,\n            avatar: user.avatar,\n            email_verified_at: user.email_verified_at,\n            activate: user.activate,\n            bx_id: user.bx_id,\n            created_at: user.created_at,\n            updated_at: user.updated_at,\n            deleted_at: user.deleted_at,\n            chats: user.chats\n          });\n        } // get user by id - admin or user (user can only access their own record)\n\n\n        if (url.match(/\\/users\\/\\d+$/) && opts.method === 'GET') {\n          if (!isLoggedIn) return unauthorised(); // get id from request url\n\n          let urlParts = url.split('/');\n          let id = parseInt(urlParts[urlParts.length - 1]); // only allow normal users access to their own record\n\n          const currentUser = users.find(x => x.role === role);\n          if (id !== currentUser.id && role !== Role.Admin) return unauthorised();\n          const user = users.find(x => x.id === id);\n          return ok(user);\n        } // get all users - admin only\n\n\n        if (url.endsWith('/users') && opts.method === 'GET') {\n          if (role !== Role.Admin) return unauthorised();\n          return ok(users);\n        } // pass through any requests not handled above\n\n\n        realFetch(url, opts).then(response => resolve(response)); // private helper functions\n\n        function ok(body) {\n          resolve({\n            ok: true,\n            text: () => Promise.resolve(JSON.stringify(body))\n          });\n        }\n\n        function unauthorised() {\n          resolve({\n            status: 401,\n            text: () => Promise.resolve(JSON.stringify({\n              message: 'Unauthorised'\n            }))\n          });\n        }\n\n        function error(message) {\n          resolve({\n            status: 400,\n            text: () => Promise.resolve(JSON.stringify({\n              message\n            }))\n          });\n        }\n      }, 500);\n    });\n  };\n}","map":{"version":3,"sources":["C:/Users/user/projects/vibe/src/_helpers/fake-backend.js"],"names":["Role","configureFakeBackend","users","id","username","password","firstName","lastName","role","Admin","name","second_name","email","phone","Provider","realFetch","window","fetch","url","opts","authHeader","headers","isLoggedIn","startsWith","roleString","split","Promise","resolve","reject","setTimeout","endsWith","method","params","JSON","parse","body","user","find","x","error","ok","token","rating","position","telegram","viber","whatsapp","site","avatar","email_verified_at","activate","bx_id","created_at","updated_at","deleted_at","chats","length","User","push","match","unauthorised","urlParts","parseInt","currentUser","then","response","text","stringify","status","message"],"mappings":"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","sourcesContent":["import { Role } from './'\r\n\r\nexport function configureFakeBackend() {\r\n  let users = [\r\n    {\r\n      id: 1,\r\n      username: 'admin',\r\n      password: 'admin',\r\n      firstName: 'Admin',\r\n      lastName: 'Admin',\r\n      role: Role.Admin,\r\n      name: \"Admin\",\r\n      second_name: null,\r\n      email: null,\r\n      phone: \"380953444348\",\r\n    },\r\n    {\r\n      id: 2,\r\n      username: 'user',\r\n      password: 'user',\r\n      firstName: 'Ivan',\r\n      lastName: 'User',\r\n      role: Role.Admin,\r\n      name: \"User\",\r\n      second_name: null,\r\n      email: null,\r\n      phone: \"380953444348\",\r\n    },\r\n    ,\r\n    {\r\n      id: 3,\r\n      username: 'pro',\r\n      password: 'pro',\r\n      firstName: 'Model',\r\n      lastName: 'Provider',\r\n      role: Role.Provider,\r\n      name: \"Model\",\r\n      second_name: null,\r\n      email: null,\r\n      phone: \"380953444348\"\r\n    }\r\n  ];\r\n\r\n  let realFetch = window.fetch;\r\n  window.fetch = function (url, opts) {\r\n    const authHeader = opts.headers['Authorization'];\r\n    const isLoggedIn = authHeader && authHeader.startsWith('Bearer fake-jwt-token');\r\n    const roleString = isLoggedIn && authHeader.split('.')[1];\r\n    const role = roleString ? Role[roleString] : null;\r\n\r\n    return new Promise((resolve, reject) => {\r\n      // wrap in timeout to simulate server api call\r\n      setTimeout(() => {\r\n        // authenticate - public\r\n        if (url.endsWith('/api/auth/login') && opts.method === 'POST') {\r\n          const params = JSON.parse(opts.body);\r\n          const user = users.find(x => x.username === params.username && x.password === params.password);\r\n          if (!user) return error('Username or password is incorrect');\r\n          return ok({\r\n            id: user.id,\r\n            username: user.username,\r\n            firstName: user.firstName,\r\n            lastName: user.lastName,\r\n            role: user.role,\r\n            token: `fake-jwt-token.${user.role}`,\r\n            name: user.name,\r\n            second_name: user.second_name,\r\n            email: user.email,\r\n            phone: user.phone,\r\n            rating: user.rating,\r\n            position: user.position,\r\n            telegram: user.telegram,\r\n            viber: user.viber,\r\n            whatsapp: user.whatsapp,\r\n            site: user.site,\r\n            avatar: user.avatar,\r\n            email_verified_at: user.email_verified_at,\r\n            activate: user.activate,\r\n            bx_id: user.bx_id,\r\n            created_at: user.created_at,\r\n            updated_at: user.updated_at,\r\n            deleted_at: user.deleted_at,\r\n            chats: user.chats\r\n          });\r\n        }\r\n\r\n        if (url.endsWith('/api/auth/register') && opts.method === 'POST') {\r\n          const params = JSON.parse(opts.body);\r\n          const user = {\r\n            id: users.length + 1,\r\n            username: params.username,\r\n            password: params.password,\r\n            firstName: 'Normal',\r\n            lastName: Role.User,\r\n            name: null,\r\n            second_name: null,\r\n            email: null,\r\n            phone: null,\r\n            rating: null,\r\n            position: null,\r\n            telegram: null,\r\n            viber: null,\r\n            whatsapp: null,\r\n            site: null,\r\n            avatar: null,\r\n            email_verified_at: null,\r\n            activate: null,\r\n            bx_id: null,\r\n            created_at: null,\r\n            updated_at: null,\r\n            deleted_at: null,\r\n            chats: null\r\n          };\r\n          users.push(user);\r\n\r\n          return ok({\r\n            id: user.id,\r\n            username: user.username,\r\n            firstName: user.firstName,\r\n            lastName: user.lastName,\r\n            role: user.role,\r\n            token: `fake-jwt-token.${user.role}`,\r\n            name: user.name,\r\n            second_name: user.second_name,\r\n            email: user.email,\r\n            phone: user.phone,\r\n            rating: user.rating,\r\n            position: user.position,\r\n            telegram: user.telegram,\r\n            viber: user.viber,\r\n            whatsapp: user.whatsapp,\r\n            site: user.site,\r\n            avatar: user.avatar,\r\n            email_verified_at: user.email_verified_at,\r\n            activate: user.activate,\r\n            bx_id: user.bx_id,\r\n            created_at: user.created_at,\r\n            updated_at: user.updated_at,\r\n            deleted_at: user.deleted_at,\r\n            chats: user.chats\r\n          });\r\n        }\r\n\r\n        // get user by id - admin or user (user can only access their own record)\r\n        if (url.match(/\\/users\\/\\d+$/) && opts.method === 'GET') {\r\n          if (!isLoggedIn) return unauthorised();\r\n\r\n          // get id from request url\r\n          let urlParts = url.split('/');\r\n          let id = parseInt(urlParts[urlParts.length - 1]);\r\n\r\n          // only allow normal users access to their own record\r\n          const currentUser = users.find(x => x.role === role);\r\n          if (id !== currentUser.id && role !== Role.Admin) return unauthorised();\r\n\r\n          const user = users.find(x => x.id === id);\r\n          return ok(user);\r\n        }\r\n\r\n        // get all users - admin only\r\n        if (url.endsWith('/users') && opts.method === 'GET') {\r\n          if (role !== Role.Admin) return unauthorised();\r\n          return ok(users);\r\n        }\r\n\r\n        // pass through any requests not handled above\r\n        realFetch(url, opts).then(response => resolve(response));\r\n\r\n        // private helper functions\r\n\r\n        function ok(body) {\r\n          resolve({ ok: true, text: () => Promise.resolve(JSON.stringify(body)) })\r\n        }\r\n\r\n        function unauthorised() {\r\n          resolve({ status: 401, text: () => Promise.resolve(JSON.stringify({ message: 'Unauthorised' })) })\r\n        }\r\n\r\n        function error(message) {\r\n          resolve({ status: 400, text: () => Promise.resolve(JSON.stringify({ message })) })\r\n        }\r\n      }, 500);\r\n    });\r\n  }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}