{"ast":null,"code":"import { Role } from './';\nexport function configureFakeBackend() {\n  let users = [{\n    id: 1,\n    username: 'admin',\n    password: 'admin',\n    firstName: 'Admin',\n    lastName: 'Admin',\n    role: Role.Admin,\n    name: \"Admin\",\n    second_name: null,\n    email: null,\n    phone: \"380953444348\"\n  }, {\n    id: 2,\n    username: 'user',\n    password: 'user',\n    firstName: 'Ivan',\n    lastName: 'User',\n    role: Role.Admin,\n    name: \"User\",\n    second_name: null,\n    email: null,\n    phone: \"380953444348\"\n  },, {\n    id: 3,\n    username: 'pro',\n    password: 'pro',\n    firstName: 'Model',\n    lastName: 'Provider',\n    role: Role.Provider,\n    name: \"Model\",\n    second_name: null,\n    email: null,\n    phone: \"380953444348\"\n  }];\n  let realFetch = window.fetch;\n\n  window.fetch = function (url, opts) {\n    const authHeader = opts.headers['Authorization'];\n    const isLoggedIn = authHeader && authHeader.startsWith('Bearer fake-jwt-token');\n    const roleString = isLoggedIn && authHeader.split('.')[1];\n    const role = roleString ? Role[roleString] : null;\n    return new Promise((resolve, reject) => {\n      // wrap in timeout to simulate server api call\n      setTimeout(() => {\n        // authenticate - public\n        if (url.endsWith('/api/auth/login') && opts.method === 'POST') {\n          const params = JSON.parse(opts.body); // const user = users.find(x => x.username === params.username && x.password === params.password);\n\n          let user;\n          users.forEach(u => {\n            if (u.password === params.password && u.username === params.username) return user = u;\n          });\n          if (!user) return error('Username or password is incorrect');\n          return ok({\n            id: user.id,\n            username: user.username,\n            firstName: user.firstName,\n            lastName: user.lastName,\n            role: user.role,\n            token: `fake-jwt-token.${user.role}`,\n            name: user.name,\n            second_name: user.second_name,\n            email: user.email,\n            phone: user.phone\n          });\n        }\n\n        if (url.endsWith('/api/auth/register') && opts.method === 'POST') {\n          const params = JSON.parse(opts.body);\n          const user = {\n            id: users.length + 1,\n            username: params.username,\n            password: params.password,\n            firstName: 'Normal',\n            lastName: Role.User,\n            name: null,\n            second_name: null,\n            email: null,\n            phone: null\n          };\n          users.push(user);\n          return ok({\n            id: user.id,\n            username: user.username,\n            firstName: user.firstName,\n            lastName: user.lastName,\n            role: user.role,\n            token: `fake-jwt-token.${user.role}`,\n            name: user.name,\n            second_name: user.second_name,\n            email: user.email,\n            phone: user.phone\n          });\n        } // get user by id - admin or user (user can only access their own record)\n\n\n        if (url.match(/\\/users\\/\\d+$/) && opts.method === 'GET') {\n          if (!isLoggedIn) return unauthorised(); // get id from request url\n\n          let urlParts = url.split('/');\n          let id = parseInt(urlParts[urlParts.length - 1]); // only allow normal users access to their own record\n\n          const currentUser = users.find(x => x.role === role);\n          if (id !== currentUser.id && role !== Role.Admin) return unauthorised();\n          const user = users.find(x => x.id === id);\n          return ok(user);\n        } // get all users - admin only\n\n\n        if (url.endsWith('/users') && opts.method === 'GET') {\n          if (role !== Role.Admin) return unauthorised();\n          return ok(users);\n        } // pass through any requests not handled above\n\n\n        realFetch(url, opts).then(response => resolve(response)); // private helper functions\n\n        function ok(body) {\n          resolve({\n            ok: true,\n            text: () => Promise.resolve(JSON.stringify(body))\n          });\n        }\n\n        function unauthorised() {\n          resolve({\n            status: 401,\n            text: () => Promise.resolve(JSON.stringify({\n              message: 'Unauthorised'\n            }))\n          });\n        }\n\n        function error(message) {\n          resolve({\n            status: 400,\n            text: () => Promise.resolve(JSON.stringify({\n              message\n            }))\n          });\n        }\n      }, 500);\n    });\n  };\n}","map":{"version":3,"sources":["/home/dev-2/WebstormProjects/vibe/src/_helpers/fake-backend.js"],"names":["Role","configureFakeBackend","users","id","username","password","firstName","lastName","role","Admin","name","second_name","email","phone","Provider","realFetch","window","fetch","url","opts","authHeader","headers","isLoggedIn","startsWith","roleString","split","Promise","resolve","reject","setTimeout","endsWith","method","params","JSON","parse","body","user","forEach","u","error","ok","token","length","User","push","match","unauthorised","urlParts","parseInt","currentUser","find","x","then","response","text","stringify","status","message"],"mappings":"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","sourcesContent":["import { Role } from './'\n\nexport function configureFakeBackend() {\n  let users = [\n    {\n      id: 1,\n      username: 'admin',\n      password: 'admin',\n      firstName: 'Admin',\n      lastName: 'Admin',\n      role: Role.Admin,\n      name: \"Admin\",\n      second_name: null,\n      email: null,\n      phone: \"380953444348\",\n    },\n    {\n      id: 2,\n      username: 'user',\n      password: 'user',\n      firstName: 'Ivan',\n      lastName: 'User',\n      role: Role.Admin,\n      name: \"User\",\n      second_name: null,\n      email: null,\n      phone: \"380953444348\",\n    },\n    ,\n    {\n      id: 3,\n      username: 'pro',\n      password: 'pro',\n      firstName: 'Model',\n      lastName: 'Provider',\n      role: Role.Provider,\n      name: \"Model\",\n      second_name: null,\n      email: null,\n      phone: \"380953444348\"\n    }\n  ];\n\n  let realFetch = window.fetch;\n  window.fetch = function (url, opts) {\n    const authHeader = opts.headers['Authorization'];\n    const isLoggedIn = authHeader && authHeader.startsWith('Bearer fake-jwt-token');\n    const roleString = isLoggedIn && authHeader.split('.')[1];\n    const role = roleString ? Role[roleString] : null;\n\n    return new Promise((resolve, reject) => {\n      // wrap in timeout to simulate server api call\n      setTimeout(() => {\n        // authenticate - public\n        if (url.endsWith('/api/auth/login') && opts.method === 'POST') {\n          const params = JSON.parse(opts.body);\n          // const user = users.find(x => x.username === params.username && x.password === params.password);\n          let user;\n          users.forEach(u => {\n            if (u.password === params.password && u.username === params.username) return user = u;\n          });\n          \n          if (!user) return error('Username or password is incorrect');\n          return ok({\n            id: user.id,\n            username: user.username,\n            firstName: user.firstName,\n            lastName: user.lastName,\n            role: user.role,\n            token: `fake-jwt-token.${user.role}`,\n            name: user.name,\n            second_name: user.second_name,\n            email: user.email,\n            phone: user.phone\n          });\n        }\n\n        if (url.endsWith('/api/auth/register') && opts.method === 'POST') {\n          const params = JSON.parse(opts.body);\n          const user = {\n            id: users.length + 1,\n            username: params.username,\n            password: params.password,\n            firstName: 'Normal',\n            lastName: Role.User,\n            name: null,\n            second_name: null,\n            email: null,\n            phone: null\n          };\n          users.push(user);\n\n          return ok({\n            id: user.id,\n            username: user.username,\n            firstName: user.firstName,\n            lastName: user.lastName,\n            role: user.role,\n            token: `fake-jwt-token.${user.role}`,\n            name: user.name,\n            second_name: user.second_name,\n            email: user.email,\n            phone: user.phone\n          });\n        }\n\n        // get user by id - admin or user (user can only access their own record)\n        if (url.match(/\\/users\\/\\d+$/) && opts.method === 'GET') {\n          if (!isLoggedIn) return unauthorised();\n\n          // get id from request url\n          let urlParts = url.split('/');\n          let id = parseInt(urlParts[urlParts.length - 1]);\n\n          // only allow normal users access to their own record\n          const currentUser = users.find(x => x.role === role);\n          if (id !== currentUser.id && role !== Role.Admin) return unauthorised();\n\n          const user = users.find(x => x.id === id);\n          return ok(user);\n        }\n\n        // get all users - admin only\n        if (url.endsWith('/users') && opts.method === 'GET') {\n          if (role !== Role.Admin) return unauthorised();\n          return ok(users);\n        }\n\n        // pass through any requests not handled above\n        realFetch(url, opts).then(response => resolve(response));\n\n        // private helper functions\n\n        function ok(body) {\n          resolve({ ok: true, text: () => Promise.resolve(JSON.stringify(body)) })\n        }\n\n        function unauthorised() {\n          resolve({ status: 401, text: () => Promise.resolve(JSON.stringify({ message: 'Unauthorised' })) })\n        }\n\n        function error(message) {\n          resolve({ status: 400, text: () => Promise.resolve(JSON.stringify({ message })) })\n        }\n      }, 500);\n    });\n  }\n}\n"]},"metadata":{},"sourceType":"module"}